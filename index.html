<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Virza Nexus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --accent: #6366f1; 
            --bg-deep: #0f172a; 
            --bg-light: #1e293b;
        }
        
        body { 
            background: radial-gradient(circle at top right, var(--bg-light), var(--bg-deep)); 
            color: #f1f5f9; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            overflow: hidden;
            height: 100vh;
        }

        .glass-bright { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }

        .portal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        @media (min-width: 640px) { .portal-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 768px) { .portal-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (min-width: 1024px) { .portal-grid { grid-template-columns: repeat(5, 1fr); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .p-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 1.25rem;
            cursor: pointer;
        }
        .p-card:hover { 
            background: rgba(99, 102, 241, 0.1); 
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.4);
        }
        .p-card:active { transform: scale(0.95); }

        .msg-pop { animation: msgPop 0.3s ease-out; }
        @keyframes msgPop { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 1023px) {
            .main-layout.split-active { flex-direction: column; }
            .main-layout.split-active .chat-panel { height: 60%; }
            .main-layout.split-active .preview-panel { height: 40%; width: 100%; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        }
        @media (min-width: 1024px) {
            .main-layout.split-active { flex-direction: row; }
            .chat-panel { flex: 1; }
            .preview-panel { width: 50%; border-left: 1px solid rgba(255, 255, 255, 0.1); }
        }

        header { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="safe-bottom">

    <div id="loader" class="fixed inset-0 z-[3000] bg-slate-950 flex items-center justify-center transition-opacity duration-500">
        <div class="w-12 h-12 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin"></div>
    </div>

    <div id="authScreen" class="fixed inset-0 z-[2000] bg-slate-900 flex items-center justify-center p-6 hidden">
        <div class="w-full max-w-sm glass-bright p-8 rounded-[2.5rem] text-center border-indigo-500/30">
            <h1 class="text-3xl font-black italic mb-2 tracking-tighter">NEXUS <span class="text-indigo-400">DAFTAR</span></h1>
            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.4em] mb-8">Login Protocol Required</p>
            <div id="authContent" class="space-y-4">
                <input type="email" id="emailIn" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-indigo-500" placeholder="Email Address">
                <input type="password" id="passIn" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-indigo-500" placeholder="Security Pin">
                <button onclick="handleAuth()" class="w-full py-4 bg-indigo-600 rounded-xl font-bold text-xs uppercase tracking-widest shadow-lg shadow-indigo-500/30">Enter Dimension</button>
            </div>
            <button onclick="handleGoogle()" class="w-full mt-4 py-3 bg-white/5 border border-white/10 rounded-xl flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-wider">
                <img src="https://www.gstatic.com/images/branding/product/1x/googleg_48dp.png" class="w-4 h-4"> Google Link
            </button>
            <button id="authToggleBtn" onclick="toggleAuthMode()" class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-6 block mx-auto">Daftar Akun Baru</button>
        </div>
    </div>

    <div id="mainUI" class="flex flex-col h-full hidden">
        <header class="h-20 glass-bright flex items-center justify-between px-6 z-50">
            <div class="flex items-center gap-3">
                <button id="backToLobby" onclick="exitPortal()" class="hidden w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center">
                    <i class="fa-solid fa-chevron-left text-xs"></i>
                </button>
                <div class="flex flex-col">
                    <div class="flex items-center gap-1.5">
                        <span id="gpsDot" class="w-2 h-2 rounded-full bg-red-500"></span>
                        <span id="locTxt" class="text-[8px] font-black text-slate-500 uppercase tracking-widest italic">OFFLINE</span>
                    </div>
                    <span id="timeDisplay" class="text-lg font-black italic tracking-tighter">00:00:00</span>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div onclick="toggleSidebar()" class="w-10 h-10 rounded-full bg-indigo-600 border-2 border-white/20 flex items-center justify-center font-black text-xs cursor-pointer shadow-lg shadow-indigo-500/20" id="userAvatar">?</div>
                <button onclick="toggleSidebar()" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-400">
                    <i class="fa-solid fa-sliders"></i>
                </button>
            </div>
        </header>

        <main class="flex-1 overflow-hidden relative">
            <div id="lobbyView" class="absolute inset-0 overflow-y-auto p-6 no-scrollbar">
                <div class="max-w-6xl mx-auto py-6">
                    <div class="mb-8">
                        <h2 class="text-3xl font-black italic tracking-tighter uppercase leading-tight">Commander, <br><span id="userNameDisp" class="text-indigo-500 text-4xl">GUEST</span></h2>
                        <p class="text-[9px] font-bold text-slate-500 uppercase tracking-[0.4em] mt-1">Select Active tools</p>
                    </div>

                    <div class="relative mb-8">
                        <i class="fa-solid fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-600"></i>
                        <input type="text" id="pSearch" oninput="filterPortals()" class="w-full bg-white/5 border border-white/10 p-4 pl-12 rounded-2xl outline-none focus:border-indigo-500 transition text-sm" placeholder="Search 20 Dimensions...">
                    </div>

                    <div id="portalGrid" class="portal-grid pb-24">
                    </div>
                </div>
            </div>

            <div id="workspaceView" class="hidden absolute inset-0 flex flex-col lg:flex-row main-layout">
                <div class="chat-panel flex flex-col h-full bg-slate-900/40">
                    <div id="chatBox" class="flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar">
                        <div class="flex justify-start">
                            <div class="max-w-[85%] bg-white/5 border border-white/5 p-4 rounded-2xl rounded-bl-none text-xs leading-relaxed text-slate-300">
                                <p class="font-bold text-indigo-400 mb-1 uppercase tracking-widest text-[10px]">Portal System:</p>
                                <span id="welcomeMsg">Siap menerima request.</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-slate-900/60 backdrop-blur-xl border-t border-white/10">
                        <div class="max-w-4xl mx-auto flex items-center gap-3">
                            <textarea id="mainInput" class="flex-1 bg-white/5 border border-white/10 rounded-2xl p-4 text-sm outline-none resize-none no-scrollbar max-h-32 focus:border-indigo-500" placeholder="Type instructions..." rows="1" oninput="autoSize(this)"></textarea>
                            <button id="sendBtn" onclick="sendMessage()" class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-600/30 active:scale-90 transition disabled:opacity-50">
                                <i class="fa-solid fa-paper-plane text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="previewPanel" class="hidden preview-panel bg-black/40 p-2">
                    <div class="h-full rounded-3xl overflow-hidden bg-white shadow-2xl relative">
                        <div class="absolute top-4 right-4 z-10">
                            <button onclick="toggleCanvas(false)" class="w-10 h-10 rounded-full bg-black/60 text-white backdrop-blur-md flex items-center justify-center shadow-xl"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                        <iframe id="artifactFrame" class="w-full h-full border-none"></iframe>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <aside id="sidebar" class="fixed inset-y-0 right-0 w-80 translate-x-full glass-bright z-[2500] transition-transform duration-500 flex flex-col p-6 shadow-2xl">
        <div class="flex justify-between items-center mb-10">
            <h3 class="font-black italic text-xl uppercase tracking-tighter">Vault <span class="text-indigo-400 italic">Access</span></h3>
            <button onclick="toggleSidebar()" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/10"><i class="fa-solid fa-xmark text-xs"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto no-scrollbar space-y-8">
            <div class="p-5 bg-white/5 rounded-3xl border border-white/5 space-y-4">
                <label class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em]">Gemini API Key</label>
                <input type="password" id="geminiKey" class="w-full bg-slate-900/50 border border-white/10 p-3 rounded-xl text-xs outline-none focus:border-indigo-500" placeholder="Enter AI Key...">
                <button onclick="saveApiKey()" class="w-full py-4 bg-indigo-600 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-indigo-500 transition shadow-lg shadow-indigo-600/20">Sync Neural Key</button>
            </div>

            <div class="space-y-4">
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] px-1 italic">Log History</label>
                <div id="historyList" class="space-y-2">
                    <p class="text-[10px] text-slate-600 text-center py-10 uppercase font-bold italic tracking-widest">No Logs Available</p>
                </div>
            </div>
        </div>

        <button onclick="handleLogout()" class="mt-8 py-4 bg-red-500/10 text-red-500 border border-red-500/20 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-red-500/20 transition">Terminasi Sesi</button>
    </aside>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, onSnapshot, serverTimestamp, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBK-MehTTzURY5jT5stH363Y5_WE4iy-XA",
            authDomain: "volca-tools.firebaseapp.com",
            projectId: "volca-tools",
            storageBucket: "volca-tools.firebasestorage.app",
            messagingSenderId: "262525907487",
            appId: "1:262525907487:web:4abc37fa3b583223569b2a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        let isLoginMode = true;
        let currentUser = null;

        onAuthStateChanged(auth, async (user) => {
            const loader = document.getElementById('loader');
            const authScreen = document.getElementById('authScreen');
            const mainUI = document.getElementById('mainUI');
            
            if(user) {
                currentUser = user;
                document.getElementById('userNameDisp').innerText = (user.displayName || user.email.split('@')[0]).toUpperCase();
                document.getElementById('userAvatar').innerText = (user.displayName || user.email.split('@')[0]).charAt(0).toUpperCase();
                
                const keyDoc = await getDoc(doc(db, 'artifacts', 'virza-v12', 'users', user.uid, 'vault', 'gemini'));
                if(keyDoc.exists()) {
                    localStorage.setItem('nexus_key', keyDoc.data().key);
                    document.getElementById('geminiKey').value = keyDoc.data().key;
                }
                authScreen.style.display = 'none';
                mainUI.style.display = 'flex';
                loadHistory();
            } else {
                authScreen.style.display = 'flex';
                mainUI.style.display = 'none';
            }
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
        });

        window.handleAuth = () => {
            const email = document.getElementById('emailIn').value;
            const pass = document.getElementById('passIn').value;
            if(!email || !pass) return;
            if(isLoginMode) {
                signInWithEmailAndPassword(auth, email, pass).catch(e => alert(e.message));
            } else {
                createUserWithEmailAndPassword(auth, email, pass).catch(e => alert(e.message));
            }
        };

        window.saveApiKey = async () => {
            const key = document.getElementById('geminiKey').value;
            if(!key || !currentUser) return;
            await setDoc(doc(db, 'artifacts', 'virza-v12', 'users', currentUser.uid, 'vault', 'gemini'), { key });
            localStorage.setItem('nexus_key', key);
            alert("API Key Synchronized.");
        };

        async function loadHistory() {
            if(!currentUser) return;
            const q = query(collection(db, 'artifacts', 'virza-v12', 'users', currentUser.uid, 'history'), orderBy('timestamp', 'desc'), limit(15));
            onSnapshot(q, (snap) => {
                const list = document.getElementById('historyList');
                list.innerHTML = "";
                snap.forEach(d => {
                    const data = d.data();
                    list.innerHTML += `
                        <div class="p-3 bg-white/5 border border-white/5 rounded-xl cursor-pointer hover:bg-white/10 transition">
                            <p class="text-[8px] text-indigo-400 font-black uppercase tracking-widest">${data.portal || 'GENERAL'}</p>
                            <p class="text-[10px] text-slate-400 truncate italic">"${data.prompt}"</p>
                        </div>
                    `;
                });
            });
        }

        window.sendMessage = async () => {
            const input = document.getElementById('mainInput');
            const prompt = input.value.trim();
            const key = localStorage.getItem('nexus_key');
            
            if(!prompt) return;
            if(!key) { alert("Input API Key in Sidebar!"); toggleSidebar(); return; }

            const chat = document.getElementById('chatBox');
            chat.innerHTML += `<div class="flex justify-end mb-4 msg-pop"><div class="max-w-[80%] bg-indigo-600 p-4 rounded-2xl rounded-br-none text-xs font-semibold shadow-lg">${prompt}</div></div>`;
            input.value = "";
            input.style.height = 'auto';
            chat.scrollTop = chat.scrollHeight;

            if(currentUser) {
                addDoc(collection(db, 'artifacts', 'virza-v12', 'users', currentUser.uid, 'history'), {
                    prompt, portal: activePortal, timestamp: serverTimestamp()
                });
            }

            try {
                document.getElementById('sendBtn').disabled = true;
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const responseText = data.candidates[0].content.parts[0].text;
                
                chat.innerHTML += `<div class="flex justify-start mb-4 msg-pop"><div class="max-w-[90%] bg-white/5 border border-white/5 p-4 rounded-2xl rounded-bl-none text-xs leading-relaxed text-slate-300">${responseText.replace(/\n/g, '<br>')}</div></div>`;
                
                const htmlMatch = responseText.match(/```html?([\s\S]*?)```/);
                if(htmlMatch) {
                    toggleCanvas(true);
                    const blob = new Blob([htmlMatch[1].trim()], { type: 'text/html' });
                    document.getElementById('artifactFrame').src = URL.createObjectURL(blob);
                }
                document.getElementById('sendBtn').disabled = false;
            } catch (e) {
                chat.innerHTML += `<div class="text-red-500 text-[9px] font-black uppercase text-center py-2 tracking-[0.3em]">Neural Link Error</div>`;
                document.getElementById('sendBtn').disabled = false;
            }
            chat.scrollTop = chat.scrollHeight;
        };
    </script>

    <script>
        function autoSize(el) {
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        function initClock() {
            const tick = () => {
                document.getElementById('timeDisplay').innerText = new Date().toLocaleTimeString('id-ID', { hour12: false });
                setTimeout(tick, 1000);
            };
            tick();
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(() => {
                    document.getElementById('gpsDot').classList.replace('bg-red-500', 'bg-green-500');
                    document.getElementById('locTxt').innerText = "SAT-LINK ACTIVE";
                });
            }
        }
        initClock();

        const allPortals = [
            { id: 'coding', name: 'Architect', icon: 'fa-code', color: '#818cf8' },
            { id: 'image', name: 'Image HD', icon: 'fa-image', color: '#f472b6' },
            { id: 'chat', name: 'Smart AI', icon: 'fa-comment', color: '#34d399' },
            { id: 'vision', name: 'Vision Pro', icon: 'fa-eye', color: '#fbbf24' },
            { id: 'web', name: 'Web Weaver', icon: 'fa-globe', color: '#60a5fa' },
            { id: 'shield', name: 'Cyber Guard', icon: 'fa-shield', color: '#f87171' },
            { id: 'math', name: 'Quantum', icon: 'fa-calculator', color: '#a78bfa' },
            { id: 'seo', name: 'SEO Master', icon: 'fa-magnifying-glass', color: '#2dd4bf' },
            { id: 'data', name: 'Data Analyst', icon: 'fa-chart-pie', color: '#fb7185' },
            { id: 'copy', name: 'Copywriter', icon: 'fa-pen-nib', color: '#fb923c' },
            { id: 'trans', name: 'Translator', icon: 'fa-language', color: '#38bdf8' },
            { id: 'legal', name: 'Legal Mind', icon: 'fa-gavel', color: '#94a3b8' },
            { id: 'health', name: 'Health Bot', icon: 'fa-heart-pulse', color: '#f43f5e' },
            { id: 'finance', name: 'Finance Pro', icon: 'fa-wallet', color: '#10b981' },
            { id: 'history', name: 'History Buff', icon: 'fa-book-atlas', color: '#d946ef' },
            { id: 'music', name: 'Music Synth', icon: 'fa-music', color: '#6366f1' },
            { id: 'game', name: 'Gaming Mod', icon: 'fa-gamepad', color: '#f59e0b' },
            { id: 'travel', name: 'Travel Guide', icon: 'fa-map-location-dot', color: '#14b8a6' },
            { id: 'social', name: 'Social Engine', icon: 'fa-share-nodes', color: '#f472b6' },
            { id: 'mind', name: 'Deep Mind', icon: 'fa-brain', color: '#a78bfa' }
        ];

        function renderPortals(data) {
            const grid = document.getElementById('portalGrid');
            grid.innerHTML = (data || allPortals).map(p => `
                <div onclick="enterPortal('${p.id}', '${p.name}')" class="p-card p-5 flex flex-col items-center gap-3">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center text-lg border border-white/5" style="background: ${p.color}15; color: ${p.color}">
                        <i class="fa-solid ${p.icon}"></i>
                    </div>
                    <span class="text-[8px] font-black uppercase tracking-widest text-slate-400 text-center">${p.name}</span>
                </div>
            `).join('');
        }
        renderPortals();

        let activePortal = "General";
        window.enterPortal = (id, name) => {
            activePortal = name;
            document.getElementById('lobbyView').classList.add('hidden');
            document.getElementById('workspaceView').classList.remove('hidden');
            document.getElementById('backToLobby').classList.remove('hidden');
            document.getElementById('welcomeMsg').innerText = `Portal ${name} Aktif. Silahkan masukkan instruksi neural Anda.`;
        };

        window.exitPortal = () => {
            document.getElementById('lobbyView').classList.remove('hidden');
            document.getElementById('workspaceView').classList.add('hidden');
            document.getElementById('backToLobby').classList.add('hidden');
            toggleCanvas(false);
        };

        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('translate-x-full');

        function toggleCanvas(show) {
            const panel = document.getElementById('previewPanel');
            const layout = document.getElementById('workspaceView');
            if(show) {
                panel.classList.remove('hidden');
                layout.classList.add('split-active');
            } else {
                panel.classList.add('hidden');
                layout.classList.remove('split-active');
            }
        }

        window.filterPortals = () => {
            const q = document.getElementById('pSearch').value.toLowerCase();
            renderPortals(allPortals.filter(p => p.name.toLowerCase().includes(q)));
        };
    </script>
</body>
</html>l
